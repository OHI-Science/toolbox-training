<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Ocean Health Index Toolbox Training</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This is the official Ocean Health Index Toolbox training.">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Ocean Health Index Toolbox Training" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the official Ocean Health Index Toolbox training." />
  <meta name="github-repo" content="ohi-science/ohi-trainings" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Ocean Health Index Toolbox Training" />
  
  <meta name="twitter:description" content="This is the official Ocean Health Index Toolbox training." />
  

<meta name="author" content="Ocean Health Index Team">


<meta name="date" content="2017-09-06">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="data-science.html">
<link rel="next" href="prep-data.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Home</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="data-science.html"><a href="data-science.html"><i class="fa fa-check"></i><b>3</b> Data science workflow</a></li>
<li class="chapter" data-level="4" data-path="toolbox-ecosystem.html"><a href="toolbox-ecosystem.html"><i class="fa fa-check"></i><b>4</b> Toolbox Ecosystem</a><ul>
<li class="chapter" data-level="4.1" data-path="toolbox-ecosystem.html"><a href="toolbox-ecosystem.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a><ul>
<li class="chapter" data-level="4.1.1" data-path="toolbox-ecosystem.html"><a href="toolbox-ecosystem.html#prerequisites"><i class="fa fa-check"></i><b>4.1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="4.1.2" data-path="toolbox-ecosystem.html"><a href="toolbox-ecosystem.html#main-folder"><i class="fa fa-check"></i><b>4.1.2</b> Main folder</a></li>
<li class="chapter" data-level="4.1.3" data-path="toolbox-ecosystem.html"><a href="toolbox-ecosystem.html#prep-folder"><i class="fa fa-check"></i><b>4.1.3</b> prep folder</a></li>
<li class="chapter" data-level="4.1.4" data-path="toolbox-ecosystem.html"><a href="toolbox-ecosystem.html#region2016"><i class="fa fa-check"></i><b>4.1.4</b> region2016</a></li>
<li class="chapter" data-level="4.1.5" data-path="toolbox-ecosystem.html"><a href="toolbox-ecosystem.html#configure_toolbox.r"><i class="fa fa-check"></i><b>4.1.5</b> configure_toolbox.r</a></li>
<li class="chapter" data-level="4.1.6" data-path="toolbox-ecosystem.html"><a href="toolbox-ecosystem.html#calculate_scores.r"><i class="fa fa-check"></i><b>4.1.6</b> calculate_scores.R</a></li>
<li class="chapter" data-level="4.1.7" data-path="toolbox-ecosystem.html"><a href="toolbox-ecosystem.html#recap"><i class="fa fa-check"></i><b>4.1.7</b> Recap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="prep-data.html"><a href="prep-data.html"><i class="fa fa-check"></i><b>5</b> Preparing data: Basic</a></li>
<li class="chapter" data-level="6" data-path="calcs-basic.html"><a href="calcs-basic.html"><i class="fa fa-check"></i><b>6</b> Calculations: basic workflow</a></li>
<li class="chapter" data-level="7" data-path="calcs-advanced.html"><a href="calcs-advanced.html"><i class="fa fa-check"></i><b>7</b> Calculations: advanced workflow</a></li>
<li class="chapter" data-level="8" data-path="updating-your-website.html"><a href="updating-your-website.html"><i class="fa fa-check"></i><b>8</b> Updating your website</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Ocean Health Index Toolbox Training</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="toolbox-ecosystem" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Toolbox Ecosystem</h1>
<p>TODO: add overview colorful figure at the end of chapter - recap.</p>
<div id="overview" class="section level2">
<h2><span class="header-section-number">4.1</span> Overview</h2>
<p>Welcome to the OHI Toolbox, the engine behind all OHI assessments! The Toolbox is an ecosystem of R scripts and data files, organized in folders and sub-folders. In this chapter, we will learn how the toolbox is structured - where you would store data, modify models, make calculations, as well as record decision-makings and produce reports.</p>
<p><em>The Toolbox ecosystem introduced here is the same in any assessment. So, if you want to explore the goal model for the Gulf of Guayaquil assessment, you could navigate to their models in the same way.</em></p>
<p>Let’s get started!</p>
<div id="prerequisites" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Prerequisites</h3>
<p>Before the training, please make sure you have done the following:</p>
<ol style="list-style-type: decimal">
<li>Have up-to-date versions of <code>R</code> and RStudio and have RStudio configured with Git/GitHub
<ul>
<li><a href="https://cloud.r-project.org" class="uri">https://cloud.r-project.org</a></li>
<li><a href="http://www.rstudio.com/download" class="uri">http://www.rstudio.com/download</a></li>
<li><a href="http://happygitwithr.com/rstudio-git-github.html" class="uri">http://happygitwithr.com/rstudio-git-github.html</a></li>
</ul></li>
<li>Fork the <strong>toolbox-demo</strong> repository into your own GitHub account by going to <a href="https://github.com/OHI-Science/toolbox-demo" class="uri">https://github.com/OHI-Science/toolbox-demo</a>, clicking “Fork” in the upper right corner, and selecting your account</li>
<li>Clone the <strong>toolbox-demo</strong> repo from your GitHub account into RStudio into a folder called “github” in your home directory (filepath “~/github”)</li>
<li>Get comfortable: be set up with two screens if possible. You will be following along in RStudio on your own computer while also watching an instructor’s screen or following this tutorial.</li>
</ol>
<p>Now you have set up your computer, let’s open the toolbox-demo repository on your computer, and go from there.</p>
</div>
<div id="main-folder" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Main folder</h3>
<p>When you first open the repository, in the main folder, you’ll encouter these files.</p>
<div class="figure">
<img src="https://docs.google.com/drawings/d/e/2PACX-1vTWGVIHdpK5UirBr2prb1rjly7t0QQNygRCL8MnvBG4Sxw_eEZJyfCu423LFzNLQ316q27YToAMJGRA/pub?w=960&amp;h=720" />

</div>
<p>Over all, all the main files you will encounter are either of the two file types:</p>
<p>** .csv files** contain data inputs or configuration information. ** .R or .Rmd scripts** are written in the programming language R and use data inputs for processing and calculations.</p>
<p>The most important files are:</p>
<ul>
<li><p><code>install_ohicore.r</code>. <code>ohicore</code> is the backbone software package of the toolbox. It is a suite of scripts that contain all the formulas to string together the data and models that you will provide for your assessment, and calculate OHI scores. You don’t need to interact with or see the inside of <code>ohicore</code> yourself during the assessment, but you do need to install this software package once at the start of your assessment by running this script.</p></li>
<li><p><code>prep</code> is a data preparation folder. As the name suggests, this is where you will store raw data, explore and format those data, and make trial runs of different models. You will spend about half the time here during an assessment.</p></li>
<li><p><code>region2016</code> is the scenario folder. The scenario folder is probably the most important folder within the repository; by default it is named regionYEAR (eg. cnc2016 for New Caledonia 2016) to indicate that the assessment is conducted at the region scale (province, state, district, etc.), based on input layers and goal models used in the most recent global assessment. It contains all of the inputs needed to calculate OHI scores, and you will modify these inputs when conducting your assessment.</p></li>
<li><p><code>README.md</code> file accompanys most folders or files, as you will discover. It’s a place to take notes for yourself, your team, and anyone interested in the future.</p></li>
</ul>
<p>Let’s take a closer look at the <code>prep</code> and <code>region2016</code> folders.</p>
</div>
<div id="prep-folder" class="section level3">
<h3><span class="header-section-number">4.1.3</span> prep folder</h3>
<p>Click on <code>prep</code> and let’s see what’s inside:</p>
<div class="figure">
<img src="https://docs.google.com/drawings/d/e/2PACX-1vRC6jKA-cwwnCDck_pGDgYjN4uA13E9a2PyFqrE-HJbQa9EIclOLLARFmYNYMyaHfdkOcaIlCXgTCSh/pub?w=960&amp;h=720" />

</div>
<p>Within <code>prep</code>, there is a sub-folder for each goal and subgoal, as well as pressures and resilience. Within each sub-folder, there are typically a <em>.Rmd</em> script and a folder to contain data, as shown in the <em>CW</em> sub-folder.</p>
<p>The <code>CSW_data_prep.Rmd</code> document is a script where you will explore your raw data, format the data, try different models, make graphs and maps, as well as document decision makings. We will come back to this script in a later chapter to learn how to prepare data for calculations.</p>
<p>We use .Rmd files because it can be rendered to a webpage, as in <code>CW_data_prep.html</code> in the same CW folder. Click open it in a web browser, and you will see a clean, human-readable webpage that can be shared and viewed by anyone.</p>
<p><em>Now let’s go back to the main folder, and click open the <code>region2016</code> folder.</em></p>
</div>
<div id="region2016" class="section level3">
<h3><span class="header-section-number">4.1.4</span> region2016</h3>
<div class="figure">
<img src="https://docs.google.com/drawings/d/e/2PACX-1vT9zIRR6AsCOHwSyuDtQBBurQ2YRo4TpRlkrO6j193ldSZN9FuAkm70mqYPJrVSzeLUokCn4CcOmpkm/pub?w=960&amp;h=720" />

</div>
<p>Again, this scenario folder contains all the data layers and scripts for you to calculate OHI scores. Let’s look into the sub-folders and see what they do.</p>
<div id="layers-layers.csv" class="section level4">
<h4><span class="header-section-number">4.1.4.1</span> layers &amp; layers.csv</h4>
<p>After you prepared your data layers in the <code>prep</code> folder, you will save them in the <code>layers</code> folder, and register them in <code>layers.csv</code>. (You will learn how to do so in Chapter @ref(data prep)).</p>
<p><code>layers</code> folder contains individual data layers as .csv files for each goal and subgoal, named in a specific manner for easy organization and recognition, as shown here.</p>
<div class="figure">
<img src="https://docs.google.com/drawings/d/e/2PACX-1vTVEC9P0g1mBsK3lFPKsl9P-RwrG0ivJdEKEa5dblQMieiVVOg5ujDG1h9_90MRnWzY4ESDAuwGzbqh/pub?w=960&amp;h=720" />

</div>
<p><code>layers.csv</code> is a data registry for all the data layers in the layers folder. It’s also a directory for <code>ohicore</code> to find the exact data layers for calculations. The file itself is spreadsheet that’s best to be opened in a spreadsheet editor such as Microsoft Excel.</p>
<div class="figure">
<img src="https://docs.google.com/drawings/d/e/2PACX-1vTtkW28E2W125z8302VIvKen-bp6sIOFHS6Kbp8CcaItEjVhlqf3GCGviJKtgLVaNu6Z2m2tvD4U8ka/pub?w=960&amp;h=720" />

</div>
</div>
<div id="conf" class="section level4">
<h4><span class="header-section-number">4.1.4.2</span> conf</h4>
<div class="figure">
<img src="https://docs.google.com/drawings/d/e/2PACX-1vTuZY4xoL1urgQSYtv093jxpneudRZmebIhW9C8JAuWOpS940Q2yP9kzVeaBwj_ajD2GTsBylLnkzD1/pub?w=960&amp;h=720" />

</div>
<p><code>conf</code> folder includes important configuration files required to calculate OHI scores. Most of the maneuvering in the Conduct phase of the assessment is done within this folder. There are both .R scripts and .csv files. Let’s see what they are.</p>
<div id="functions.r" class="section level5">
<h5><span class="header-section-number">4.1.4.2.1</span> functions.R</h5>
<div class="figure">
<img src="https://docs.google.com/drawings/d/e/2PACX-1vS2ePP1saxdgCYsy7bC1UxlwiJCyHgzIj-zDdKLrRWKzecp7NI8aRoZOsPddCwTb6RADiZ9xji-RzQx/pub?w=960&amp;h=720" />

</div>
<p>This R script contains the equations for each goal and sub-goal model. Much of your time will be spent here modifying goal models with the data you prepared in <code>prep</code> folder.</p>
<p>Each goal and sub-goal equation is stored as a separate function within the script. These functions calculate the status and trend using prepared layers saved in the ‘layers’ folder and registered in layers.csv.</p>
<!--- info about the rest of the conf files are modified from the manual --->
</div>
</div>
<div id="pressures-resilience" class="section level4">
<h4><span class="header-section-number">4.1.4.3</span> pressures &amp; resilience</h4>
<p>There are four .csv files relating to pressures and resilience.</p>
<ul>
<li>pressures_categories.csv</li>
<li>pressures_matrix.csv</li>
<li>pressures_categories.csv</li>
<li>pressures_matrix.csv</li>
</ul>
<p>They are spreadsheets best to be opened with Excel.</p>
<div class="figure">
<img src="https://docs.google.com/drawings/d/e/2PACX-1vQDM2iViRuigEadiGHhoG1CV_5DAvowpDZI4qTR7jZbg7-0QXfHxDJHjgxN2Z4g4bBTCQNknMkG_qiT/pub?w=960&amp;h=720" />

</div>
<p>Pressures and Resilience are two of the four dimensions used to evaluate each goal or sub-goal, along with Status and Trend that you calculate in functions.R. We will go through how to modify these tables in Chapter @ref(pressures resilience) later.</p>
<p>Now, we won’t dwell on these files much except to show you where they are, but you can refer back to this section for the detailed information listed below when you get to Chapter @ref(pressures resilience) <!--- too muchh info?? it takes up a lot of room for information that's above the introductory level. people are pretty far from using these files. but i think we should have this info here for future reference. ---></p>
<p><strong>pressures_categories.csv</strong></p>
<p>This is a table to record the name of each pressures data layer, its category, and sub-category. Each data layer name is the same name that’s saved in the layers folder and is registered in layers.csv. Each layer falls under one of two categories - ecological or social pressures, and one of several sub-categories to further represent the origin of the pressure (e.g. climate change, fishing, etc), which is also indicated by a prefix of each data layer name (for example: po_ for the pollution sub-category). For more information, see how to modify pressures layers.</p>
<p><strong>pressures_matrix.csv</strong></p>
<p>It is a table that indicates which individual pressures (stressors) affect which goal, sub-goals, or components, and weights them from 1-3 (a weight of 0 is shown as a blank). A higher weight indicates more negative impacts on that goal or component of the goal. These weights are relative to each row of the matrix (goal, sub-goal, or component). These weights are used in global assessments based on scientific literature and expert opinion, and you can modify the weightings if necessary for your assessment. The pressures matrix is the same as Table S25 in the Supplementary Information for Halpern et al. 2012.</p>
<p>Each pressure (column) of the pressures matrix is the layer name of the pressures layer file that is saved in the layers folder and is registered in layers.csv, matching what’s recorded in the pressures_categories.csv. For more information, see how to modify pressures layers.</p>
<p><strong>resilience_categories.csv</strong></p>
<p>Similar to pressures_categories.csv, this file contains information on each resilience data layer, including its name, category, and sub-category. Each resilience layer’s name is the same as the data layer to be saved in the layers folder and is registered in layers.csv. In addition, it also includes information on category type - ecosystem, regulatory, or social, indicating the origin of the resilience layer.</p>
<p>Each resilience layer is also assigned a weight of 0-1, representing the level of resilience against pressures. Different from the values used in pressures matrix, the resilience weights depend on the level of information available. For more information, read how to modify resilience layers.</p>
<p><strong>resilience_matrix.csv</strong></p>
<p>It is a table that indicates which individual resilience measures affect which goal, sub-goals, or components. These weights are stored in a separate file in the conf folder: resilience_weights.csv. The resilience matrix is the same as Table S26 in the Supplementary Information for Halpern et al. 2012. For more information, read how to modify resilience layers.</p>
</div>
<div id="config.r" class="section level4">
<h4><span class="header-section-number">4.1.4.4</span> config.R</h4>
<p>It configures labeling and constants appropriately. You will only need to modify this file when working with goals that have categories (example: habitat types or economy sectors) that are affected differently by pressures and resilience measures.</p>
</div>
<div id="goals.csv" class="section level4">
<h4><span class="header-section-number">4.1.4.5</span> goals.csv</h4>
<p>goals.csv is a table with information about goals and sub-goals, including:</p>
<ul>
<li>order_color &amp; order_hierarchy: the order to display in flower plots</li>
<li>order_calculate: the order in which the goals and sub-goals are calculated for the overall index scores</li>
<li>goal &amp; parent: indicates the relationship between sub-goals and supra-goals (i.e. goals - with sub-goals)</li>
<li>weight: how each goal is weighted to calculate the final Index scores</li>
<li>preindex_function: indicate what parameters are called to calculate scores for goals and - sub-goals in functions.r</li>
<li>postindex_function: indicate what parameters are called to calculate scores for supra-goals in functions.r</li>
</ul>
<p><em>We have just gone over the files in the <code>conf</code> folder. Let’s take a step back to the <code>region2016</code> folder, and check out what else are there.</em></p>
</div>
</div>
<div id="configure_toolbox.r" class="section level3">
<h3><span class="header-section-number">4.1.5</span> configure_toolbox.r</h3>
<div class="figure">
<img src="https://docs.google.com/drawings/d/e/2PACX-1vSfm3eOmTbowpx1e2zUYIz08a_aWW16fhVhnH47AUz4GZZEsJMtTR4Flplx-5Wwex0TG31PoGy4E5nA/pub?w=960&amp;h=720" />

</div>
<p>This script does the pre-checks before running goal models and calculate scores. It loads <code>ohicore</code>, calls all goal functions and data layers in the “conf” folder, and check that all data layers are registered properly. You are encouraged to use this script when you’re working on individual goal models. After you register data layers for a goal, or make any changes to the data layers, source this script before running model-specific functions in functions.R.</p>
</div>
<div id="calculate_scores.r" class="section level3">
<h3><span class="header-section-number">4.1.6</span> calculate_scores.R</h3>
<div class="figure">
<img src="https://docs.google.com/drawings/d/e/2PACX-1vTeKKHmsK8hy6kICeJ-tAZsvBy_QqAeYdn7JcthxM4AbCeJDcpZ8UhHnGMXdy1DcJBfF0IJrpFFSKke/pub?w=960&amp;h=720" />

</div>
<p><code>calculate_scores.R</code> is a script you’ll come to use often. As the name tells us, it is a script to calculate OHI scores. Whenever you change any data in<code>layers</code>, modify models in <code>functions.R</code>, and make changes to pressures and resilience, you could run this script and see how the OHI scores change.</p>
<p>This script runs everything required to calculate OHI scores using the prepared layers the layers folder that are registered in layers.csv. Scores will be saved in scores.csv.</p>
</div>
<div id="recap" class="section level3">
<h3><span class="header-section-number">4.1.7</span> Recap</h3>
<p>Toolbox is a ecosystem of data layers and scripts, contained in folders and their sub-folders.</p>
<p>Behind the scenes in the Toolbox, there is a backbone package called <code>ohicore</code>. You won’t interact with it directly, but you will need to install this package at the beginning of your assessment.</p>
<p>At the first stage of your asssessmemt, you will spend most of your time in <code>prep</code> folder, where you upload, explore, and format your data layers to be saved in the scenario folder <code>region2016</code> for the next step of calculations.</p>
<p><code>region2016</code> is a folder with all the data layers, files, and scripts you’ll need to calculate scores. There you will register finished data layers, modify goal models, modify pressures and resilience, calculate OHI scores, and make flowerplots.</p>
<p>Below is a figure that summarizes the information we just went through, in relation to the steps you would take in an assessment for future reference.</p>
<div class="figure">
<img src="https://docs.google.com/drawings/d/e/2PACX-1vRlYbRI6_ljU7FYP3RivcR5Pvz04cx00Fpq_tflrSN8loS46YtI3DbqyBwZ_OI68IvWCZzWl8HsqX3u/pub?w=960&amp;h=600" />

</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-science.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="prep-data.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
