# Preparing data: Basic {#prep-data}

The purpose of Chapter \@ref(prep-data) is to introduce you to the basic workflow for preparing data for OHI. This is a a 2-hour hands-on training: you will be following along on your own computer and working with a copy of the demonstration repository that is used throughout the this chapter.

## Overview

<!---TODO Ning: 

- did we decide to call it a Prep Repo or a Starter Repo? You say both here, and Starter repo in the manual. We'll have to change the Manual: http://ohi-science.org/manual/#the-starter-repo. Maybe we should stay with 'Prep' repo since that's more consistent language/less vocabulary. If you agree, can you update the manual?

- can you add screenshots from the toolbox-demo repo, imagining that you are teaching it? I flagged a few places in particular

- I think that we should have them open their repo earlier and explore the data layers with us as we tell them about them, so that it is more interactive/less of a presentation
--->

Preparing data takes the biggest chunk of time when you're using the OHI Toolbox, more than the final calculation of the OHI scores itself! The Prep Repo aims to help you wade through these important steps of the assessment. Treat prep files as your notebook, calculator, and presentation of your work. You can explore raw data, see whether it fits with your ideal spatial boundaries and whether it makes sense to include it in your final calculations. If it does, you can format it further and save it as data layers. The process of data exploration is recorded and can be easily shared with anyone, and your team will have a record of what your explorations and decisions. 

**Why prepare data in the Toolbox?** This is for transparency, reproducibility, and credibility. If someone wants to understand what data you're using, how you have processed it, and your rationale for including it or excluding other options, they can find the answers here. With this reproducible record, you will be able to repeat these methods with additional years of data using the same code you have already written. This is helpful for you and your team. In a few months, or years, you can visit these files and remember what you had done. It also makes your technical team more stable. If there are personale changes, your team memory is preserved. It's easier for new members to pick up where it was left when your data preparation has been documented clearly and kept in one place. 

**Why R Markdown?** R Markdown produces a report with your comments, `R` code, and figures/tables embedded in it. It can be rendered as a nice HTML webpage that is easy to update and share with other people. We highly recommend it to anyone who is interested in open science, especially OHI+ users. However, if you prefer to use an `R` script with comments inside, that is also an option. You can follow this tutorial using `example_prep_non_spatial.R` instead of the `example_prep_non_spatial.Rmd`.

**What will you learn in this chapter?** 

We will go through: 

- formatting requirements of each data layer
- a hands-on tutorial in which you can use sample data to format and save
- how to register each data layer

### Prerequisites

<!--- TODO Ning can you add write this section? This is the one from \@ref(calcs-basic) as guidance 

Before the training, please make sure you have done the following: 

1. Have up-to-date versions of `R` and RStudio and have RStudio configured with Git/GitHub 
    - https://cloud.r-project.org
    - http://www.rstudio.com/download 
    - http://happygitwithr.com/rstudio-git-github.html 
1. Fork the **toolbox-demo** repository into your own GitHub account by going to https://github.com/OHI-Science/toolbox-demo, clicking "Fork" in the upper right corner, and selecting your account
1. Clone the **toolbox-demo** repo from your GitHub account into RStudio into a folder called "github" in your home directory (filepath "~/github")
1. Get comfortable: be set up with two screens if possible. You will be following along in RStudio on your own computer while also watching an instructor's screen or following this tutorial.

--->


## Data Formatting requirements

>The OHI Toolbox expects each data layer to be:

>- in its own *.csv* file
- with data available for every region within the study area
- with data organized in 'long' format (as few columns as possible) 
- with a unique region identifier (*rgn_id*) associated with a single score or value.

As you discover and gather potential data sources, they can be prepared and explored in the <!---TODO Prep---> Starter Repo. Data preparation is done in `**R**` using input data stored in **_.csv files_** (or 'comma-separated value'). These files can be opened as a spreadsheet using Microsoft Excel or similar programs. Each data layer (data input) has its own *.csv* file, which is combined with others within the Toolbox for the model calculations. These data layers are used for calculating goal scores, meaning that they are inputs for status, trend, pressures, and resilience. The global analysis included over 100 data layer files, and there will probably be as many in your own assessments. This section describes and provides examples of how to format the data layers for the Toolbox.


> It is highly recommended that layer preparation occurs in your repository's `prep` folder as much as possible, as it will also be archived by GitHub for future reference. The folder is divided into sub-folders for each goal and sub-goal so you can store raw and intermediate data as you work in `R` and R Markdown.

**OHI goal scores are calculated at the scale of the reporting unit**, which is called a ‘**region**’ and then combined using an area-weighted average to produce the score for the overall area assessed, called a ‘**study area**’. In order to calculate trend, input data should be available as a time series for at least 5 recent years (and the longer the time series the better, as this can be used in setting temporal reference points).

>Finalized data layers have at least two columns: the `rgn_id` column and a column with data that is best identified by its units (eg. _km2_ or _score_). There often may be a `year` column or a `category` column (for natural product categories or habitat types).

The example below shows information for a study area with 4 regions. There are two different (and separate) data layer files: tourism count (`tr_total.csv`) and natural products harvested, in metric tonnes (`np_harvest_tonnes.csv`). Each file has data for four regions (1-4) in different years, and the second has an additional 'categories' column for the different types of natural products that were harvested. In this example, the two data layers are appropriate for status calculations with the Toolbox because:

<!---TODO
add screenshot of this example layer with rgn_id, year, category, etc. Could also change the example
--->

1. At least five years of data are available,
2. There are no data gaps
3. Data are presented in 'long' or 'narrow' format (not 'wide' format -- see "**Long Formatting**"" section).

When data gaps, temporal or spatial, are inevitable, various gap-filling techniques can be used. We won't go through the details here. For more information and examples, visit [OHI Manual](http://ohi-science.org/manual/#gapfilling). 

## Data Wrangling

<!--- TODO
build out this section more
--->

How do we get from raw data to a data layer? Here is an [example](https://github.com/OHI-Science/bhi/blob/draft/baltic2015/prep/CW/eutrophication/eutrophication_prep.md) of data prep document. Let's give it a try to make one just like this. 

<!--- TODO
I think they should do this earlier
--->
Go to your `toolbox-demo` repository, open `prep/CW/CW_data_prep.Rmd`, and follow the tutorials from there. 


## Save and Register data layers 

<!--- TODO
build out this section more, more screenshots, etc
--->
Before processed data can be used by the Toolbox for calculations, they need to be saved and registered here: 

![](https://docs.google.com/drawings/d/1IwHf8pMBlpzOIYKL0hoEF5rETGA765Qtwkz7es7B3Rg/pub?h=500)

You have in the data prep script saved the data layer in `layers` folder, now let's register it so that OHI Toolbox knows where to look for data when you calculate scores. 

## Register data layers in `layers.csv`  

<!--- TODO
build out this section more, more screenshots, etc
--->

Data layers are registered in `layers.csv`. 

![](https://docs.google.com/drawings/d/1juueRiA0gevOoHH_8owzLNanyQ-H1mAOEl7L_l5YSJ0/pub?h=600)  

_If a layer simply has a new filename, only the *filename* column needs to be updated._

